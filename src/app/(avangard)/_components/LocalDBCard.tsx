"use client";

import { getLocal_db, PrismaDataResponse } from "@/app/admin/compare/actions";
import { _date, _dbDateParser } from "@/Helpers/dateFuncs";
import { LocalDiningTwoTone } from "@mui/icons-material";
import {
    Alert,
    Box,
    Card,
    CardContent,
    CardHeader,
    Divider,
    Grow,
} from "@mui/material";
import { useQuery } from "@tanstack/react-query";
import { useMemo } from "react";

export function DB_CardLocal({ take, skip }: { take?: number; skip?: number }) {
    const q = useQuery({
        queryKey: ["events", "local"],
        queryFn: getData,
    });

    const events_data = useMemo(() => {
        return (
            q.data?.map((e) => ({
                id: e.id,
                date: _dbDateParser(e.date_formated).dd_mmmm,
            })) || []
        );
    }, [q.data]);
    if (q.isError) {
        return <Alert>{q.error.message}</Alert>;
    }
    const text = "Local: " + q.data?.length;
    return (
        <Card elevation={3} sx={{ maxHeight: "50vh", overflow: "auto" }}>
            <CardHeader title={text} />
            <Divider></Divider>
            <CardContent>
                {q.isLoading && (
                    <Alert color="warning" icon={<LocalDiningTwoTone />}>
                        Loading...
                    </Alert>
                )}
                {events_data.map((e, idx) => (
                    <Box key={e.id}>{e.date}</Box>
                ))}
            </CardContent>
        </Card>
    );
}

async function getData() {
    const db = await getLocal_db();
    return db.event as PrismaDataResponse["event"];
}

const json = {
    id: 107,
    cost: 1,
    date_formated: "2024-09-06",
    pairs: [
        { eventId: 107, playerId: 32, masterId: null },
        { eventId: 107, playerId: 7, masterId: null },
        { eventId: 107, playerId: 20, masterId: null },
        { eventId: 107, playerId: 46, masterId: null },
    ],
    players: [
        {
            id: 7,
            events: [
                { date_formated: "2024-06-21", id: 81 },
                { date_formated: "2024-06-26", id: 82 },
                { date_formated: "2024-07-03", id: 84 },
                { date_formated: "2024-07-05", id: 85 },
                { date_formated: "2024-07-10", id: 86 },
                { date_formated: "2024-07-19", id: 89 },
                { date_formated: "2024-05-24", id: 72 },
                { date_formated: "2024-05-22", id: 73 },
                { date_formated: "2024-05-29", id: 74 },
                { date_formated: "2024-06-05", id: 76 },
                { date_formated: "2024-06-12", id: 78 },
                { date_formated: "2024-07-24", id: 93 },
                { date_formated: "2024-07-31", id: 95 },
                { date_formated: "2024-08-02", id: 96 },
                { date_formated: "2024-08-21", id: 101 },
                { date_formated: "2024-08-23", id: 102 },
                { date_formated: "2024-08-28", id: 103 },
                { date_formated: "2024-09-04", id: 106 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [
                {
                    id: 368,
                    firstPlayerId: 1,
                    secondPlayerId: 7,
                    masterId: 1,
                    playerId: 7,
                    eventId: 85,
                },
                {
                    id: 390,
                    firstPlayerId: 1,
                    secondPlayerId: 7,
                    masterId: null,
                    playerId: 7,
                    eventId: 107,
                },
            ],
            ticket: {
                uuid: "5ad35f80-a69c-4db5-b315-5d343625b037",
                amount: 10,
                limit: 10,
                eAt: "2025-01-01",
                event_dates: [],
                playerId: 7,
            },
            name: "Лариса Басманова",
        },
        {
            id: 8,
            events: [
                { date_formated: "2024-06-28", id: 83 },
                { date_formated: "2024-07-05", id: 85 },
                { date_formated: "2024-07-12", id: 87 },
                { date_formated: "2024-05-24", id: 72 },
                { date_formated: "2024-05-29", id: 74 },
                { date_formated: "2024-07-31", id: 95 },
                { date_formated: "2024-08-02", id: 96 },
                { date_formated: "2024-08-14", id: 99 },
                { date_formated: "2024-08-21", id: 101 },
                { date_formated: "2024-08-28", id: 103 },
                { date_formated: "2024-08-30", id: 104 },
                { date_formated: "2024-09-04", id: 106 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [
                {
                    id: 383,
                    firstPlayerId: 2,
                    secondPlayerId: 8,
                    masterId: null,
                    playerId: 8,
                    eventId: 103,
                },
            ],
            ticket: null,
            name: "Олег Котляров",
        },
        {
            id: 15,
            events: [
                { date_formated: "2024-06-19", id: 80 },
                { date_formated: "2024-06-21", id: 81 },
                { date_formated: "2024-06-26", id: 82 },
                { date_formated: "2024-06-28", id: 83 },
                { date_formated: "2024-07-05", id: 85 },
                { date_formated: "2024-07-10", id: 86 },
                { date_formated: "2024-07-12", id: 87 },
                { date_formated: "2024-07-17", id: 88 },
                { date_formated: "2024-07-19", id: 89 },
                { date_formated: "2024-05-24", id: 72 },
                { date_formated: "2024-05-22", id: 73 },
                { date_formated: "2024-05-29", id: 74 },
                { date_formated: "2024-05-31", id: 75 },
                { date_formated: "2024-06-05", id: 76 },
                { date_formated: "2024-06-07", id: 77 },
                { date_formated: "2024-06-14", id: 79 },
                { date_formated: "2024-07-24", id: 93 },
                { date_formated: "2024-07-31", id: 95 },
                { date_formated: "2024-08-02", id: 96 },
                { date_formated: "2024-08-09", id: 98 },
                { date_formated: "2024-08-14", id: 99 },
                { date_formated: "2024-08-21", id: 101 },
                { date_formated: "2024-08-23", id: 102 },
                { date_formated: "2024-08-28", id: 103 },
                { date_formated: "2024-08-30", id: 104 },
                { date_formated: "2024-09-04", id: 106 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [],
            ticket: {
                uuid: "f9ea817f-2138-49e1-ae93-2d274728c675",
                amount: 10,
                limit: 10,
                eAt: "2025-01-01",
                event_dates: [],
                playerId: 15,
            },
            name: "Сергей Коробов",
        },
        {
            id: 20,
            events: [
                { date_formated: "2024-06-21", id: 81 },
                { date_formated: "2024-06-26", id: 82 },
                { date_formated: "2024-06-28", id: 83 },
                { date_formated: "2024-07-10", id: 86 },
                { date_formated: "2024-07-12", id: 87 },
                { date_formated: "2024-07-17", id: 88 },
                { date_formated: "2024-05-24", id: 72 },
                { date_formated: "2024-05-22", id: 73 },
                { date_formated: "2024-05-29", id: 74 },
                { date_formated: "2024-05-31", id: 75 },
                { date_formated: "2024-06-05", id: 76 },
                { date_formated: "2024-07-31", id: 95 },
                { date_formated: "2024-08-02", id: 96 },
                { date_formated: "2024-08-07", id: 97 },
                { date_formated: "2024-08-09", id: 98 },
                { date_formated: "2024-08-14", id: 99 },
                { date_formated: "2024-08-16", id: 100 },
                { date_formated: "2024-08-21", id: 101 },
                { date_formated: "2024-08-23", id: 102 },
                { date_formated: "2024-08-28", id: 103 },
                { date_formated: "2024-08-30", id: 104 },
                { date_formated: "2024-09-04", id: 106 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [
                {
                    id: 375,
                    firstPlayerId: 1,
                    secondPlayerId: 20,
                    masterId: null,
                    playerId: 20,
                    eventId: 88,
                },
                {
                    id: 382,
                    firstPlayerId: 1,
                    secondPlayerId: 20,
                    masterId: null,
                    playerId: 20,
                    eventId: 96,
                },
                {
                    id: 391,
                    firstPlayerId: 1,
                    secondPlayerId: 20,
                    masterId: null,
                    playerId: 20,
                    eventId: 107,
                },
            ],
            ticket: {
                uuid: "db4fe3eb-5c75-4616-b642-66a582479320",
                amount: 10,
                limit: 10,
                eAt: "2025-01-01",
                event_dates: [],
                playerId: 20,
            },
            name: "Надежда Отпетова",
        },
        {
            id: 27,
            events: [
                { date_formated: "2024-07-26", id: 94 },
                { date_formated: "2024-08-14", id: 99 },
                { date_formated: "2024-08-16", id: 100 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [],
            ticket: null,
            name: "Сергей Юрцев",
        },
        {
            id: 32,
            events: [
                { date_formated: "2024-06-12", id: 78 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [
                {
                    id: 389,
                    firstPlayerId: 2,
                    secondPlayerId: 32,
                    masterId: null,
                    playerId: 32,
                    eventId: 107,
                },
            ],
            ticket: null,
            name: "Лена Сластная",
        },
        {
            id: 43,
            events: [
                { date_formated: "2024-07-05", id: 85 },
                { date_formated: "2024-07-10", id: 86 },
                { date_formated: "2024-07-26", id: 94 },
                { date_formated: "2024-08-02", id: 96 },
                { date_formated: "2024-08-14", id: 99 },
                { date_formated: "2024-08-16", id: 100 },
                { date_formated: "2024-08-28", id: 103 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [
                {
                    id: 378,
                    firstPlayerId: 1,
                    secondPlayerId: 43,
                    masterId: null,
                    playerId: 43,
                    eventId: 100,
                },
            ],
            ticket: null,
            name: "Андрей Руденко",
        },
        {
            id: 45,
            events: [
                { date_formated: "2024-06-26", id: 82 },
                { date_formated: "2024-07-03", id: 84 },
                { date_formated: "2024-07-17", id: 88 },
                { date_formated: "2024-05-22", id: 73 },
                { date_formated: "2024-05-29", id: 74 },
                { date_formated: "2024-06-05", id: 76 },
                { date_formated: "2024-06-07", id: 77 },
                { date_formated: "2024-06-12", id: 78 },
                { date_formated: "2024-06-14", id: 79 },
                { date_formated: "2024-07-24", id: 93 },
                { date_formated: "2024-07-31", id: 95 },
                { date_formated: "2024-08-07", id: 97 },
                { date_formated: "2024-08-30", id: 104 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [],
            ticket: {
                uuid: "ccbc550a-4c6c-4cc0-a389-5b2fbf7e3e60",
                amount: 10,
                limit: 10,
                eAt: "2025-01-01",
                event_dates: [],
                playerId: 45,
            },
            name: "Сергей Попов",
        },
        {
            id: 46,
            events: [
                { date_formated: "2024-07-10", id: 86 },
                { date_formated: "2024-07-19", id: 89 },
                { date_formated: "2024-05-24", id: 72 },
                { date_formated: "2024-06-05", id: 76 },
                { date_formated: "2024-07-24", id: 93 },
                { date_formated: "2024-07-26", id: 94 },
                { date_formated: "2024-08-09", id: 98 },
                { date_formated: "2024-08-30", id: 104 },
                { date_formated: "2024-09-04", id: 106 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [
                {
                    id: 364,
                    firstPlayerId: 2,
                    secondPlayerId: 46,
                    masterId: 2,
                    playerId: 46,
                    eventId: 86,
                },
                {
                    id: 370,
                    firstPlayerId: 2,
                    secondPlayerId: 46,
                    masterId: null,
                    playerId: 46,
                    eventId: 104,
                },
                {
                    id: 376,
                    firstPlayerId: 2,
                    secondPlayerId: 46,
                    masterId: null,
                    playerId: 46,
                    eventId: 89,
                },
                {
                    id: 387,
                    firstPlayerId: 2,
                    secondPlayerId: 46,
                    masterId: null,
                    playerId: 46,
                    eventId: 106,
                },
                {
                    id: 392,
                    firstPlayerId: 2,
                    secondPlayerId: 46,
                    masterId: null,
                    playerId: 46,
                    eventId: 107,
                },
                {
                    id: 396,
                    firstPlayerId: 2,
                    secondPlayerId: 46,
                    masterId: null,
                    playerId: 46,
                    eventId: 94,
                },
                {
                    id: 401,
                    firstPlayerId: 2,
                    secondPlayerId: 46,
                    masterId: null,
                    playerId: 46,
                    eventId: 93,
                },
                {
                    id: 406,
                    firstPlayerId: 2,
                    secondPlayerId: 46,
                    masterId: null,
                    playerId: 46,
                    eventId: 98,
                },
            ],
            ticket: null,
            name: "Надя Бучина",
        },
        {
            id: 207,
            events: [
                { date_formated: "2024-08-14", id: 99 },
                { date_formated: "2024-08-16", id: 100 },
                { date_formated: "2024-08-21", id: 101 },
                { date_formated: "2024-08-23", id: 102 },
                { date_formated: "2024-08-28", id: 103 },
                { date_formated: "2024-08-30", id: 104 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [],
            ticket: {
                uuid: "6ac4a3d9-72a9-4c8c-98d4-d5bcd34a36b5",
                amount: 5,
                limit: 5,
                eAt: "2025-01-01",
                event_dates: [],
                playerId: 207,
            },
            name: "Фёдор Наумов",
        },
        {
            id: 208,
            events: [
                { date_formated: "2024-08-14", id: 99 },
                { date_formated: "2024-08-21", id: 101 },
                { date_formated: "2024-09-04", id: 106 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [],
            ticket: null,
            name: "Коля Шантурин",
        },
        {
            id: 44,
            events: [
                { date_formated: "2024-06-19", id: 80 },
                { date_formated: "2024-06-21", id: 81 },
                { date_formated: "2024-06-26", id: 82 },
                { date_formated: "2024-06-28", id: 83 },
                { date_formated: "2024-07-03", id: 84 },
                { date_formated: "2024-07-05", id: 85 },
                { date_formated: "2024-07-19", id: 89 },
                { date_formated: "2024-05-24", id: 72 },
                { date_formated: "2024-05-22", id: 73 },
                { date_formated: "2024-06-05", id: 76 },
                { date_formated: "2024-06-07", id: 77 },
                { date_formated: "2024-08-09", id: 98 },
                { date_formated: "2024-08-14", id: 99 },
                { date_formated: "2024-08-16", id: 100 },
                { date_formated: "2024-08-23", id: 102 },
                { date_formated: "2024-08-28", id: 103 },
                { date_formated: "2024-09-04", id: 106 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [
                {
                    id: 377,
                    firstPlayerId: 1,
                    secondPlayerId: 44,
                    masterId: null,
                    playerId: 44,
                    eventId: 100,
                },
            ],
            ticket: null,
            name: "Олег Мельников",
        },
        {
            id: 11,
            events: [
                { date_formated: "2024-06-19", id: 80 },
                { date_formated: "2024-06-21", id: 81 },
                { date_formated: "2024-06-26", id: 82 },
                { date_formated: "2024-06-28", id: 83 },
                { date_formated: "2024-07-03", id: 84 },
                { date_formated: "2024-07-05", id: 85 },
                { date_formated: "2024-07-10", id: 86 },
                { date_formated: "2024-07-12", id: 87 },
                { date_formated: "2024-07-17", id: 88 },
                { date_formated: "2024-07-19", id: 89 },
                { date_formated: "2024-05-24", id: 72 },
                { date_formated: "2024-05-22", id: 73 },
                { date_formated: "2024-05-29", id: 74 },
                { date_formated: "2024-05-31", id: 75 },
                { date_formated: "2024-06-05", id: 76 },
                { date_formated: "2024-06-07", id: 77 },
                { date_formated: "2024-06-12", id: 78 },
                { date_formated: "2024-06-14", id: 79 },
                { date_formated: "2024-07-24", id: 93 },
                { date_formated: "2024-07-26", id: 94 },
                { date_formated: "2024-07-31", id: 95 },
                { date_formated: "2024-08-02", id: 96 },
                { date_formated: "2024-08-07", id: 97 },
                { date_formated: "2024-08-09", id: 98 },
                { date_formated: "2024-08-14", id: 99 },
                { date_formated: "2024-08-16", id: 100 },
                { date_formated: "2024-08-21", id: 101 },
                { date_formated: "2024-08-23", id: 102 },
                { date_formated: "2024-09-04", id: 106 },
                { date_formated: "2024-09-06", id: 107 },
            ],
            pair: [
                {
                    id: 365,
                    firstPlayerId: 2,
                    secondPlayerId: 11,
                    masterId: 2,
                    playerId: 11,
                    eventId: 87,
                },
                {
                    id: 372,
                    firstPlayerId: 1,
                    secondPlayerId: 11,
                    masterId: null,
                    playerId: 11,
                    eventId: 88,
                },
                {
                    id: 397,
                    firstPlayerId: 1,
                    secondPlayerId: 11,
                    masterId: null,
                    playerId: 11,
                    eventId: 94,
                },
            ],
            ticket: {
                uuid: "830f2eb5-cac7-4e8d-bd00-a87f9245b847",
                amount: 10,
                limit: 10,
                eAt: "2025-01-01",
                event_dates: [],
                playerId: 11,
            },
            name: "Павел Роднянский",
        },
    ],
    title: "Тренировка",
};
